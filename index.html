<!DOCTYPE html>
<html>
	<head>
	    <title>Socket.io Expo</title>
	    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
	</head>
	<body>
		<script>
		    window.WebSocket = window.WebSocket || window.MozWebSocket;

		    var connection = new WebSocket('ws://192.168.2.167:3000', 'upup');

		    connection.onopen = function () {
		        alert('Your connection is open and ready to use!');
		    };

		    connection.onerror = function (error) {
		        alser('You meet some error!')
		    };

		    connection.onmessage = function (message) {
		    	var msg = JSON.parse(message.data)

		    	if(msg.type === 'fight_win'){
		    		$("#fight_notice").text('Yeah you win!!');

		    	} else if (msg.type === 'current_info'){
		    		$('#user_notice').text('your id is:' + msg.data.id);


		    	} else if (msg.type === 'leave_success'){
		    		alert(msg.data);
		    		$("#wait_fight").hide();
		    		$("#btn_fight").attr('disabled', false);

		    	} else if (msg.type === 'find_user'){
		    		$("#fight_notice").text(msg.data.text + '. and the user is:' + msg.data.name + '. and the room id is' + msg.data.room);
		    		$("#leave_waiting_btn").hide();
		    		$("#into_fight").show();

		    	} else if (msg.type === 'force_leave'){
		    		alert(msg.data);
		    		$("#wait_fight").hide();
		    		$("#btn_fight").attr('disabled', false);
		    		$("#fight_notice").text('');
		    		$("#into_fight").hide();

		    	} else if (msg.type === 'another_leave'){
		    		alert(msg.data);
		    		$("#wait_fight").hide();
		    		$("#btn_fight").attr('disabled', false);
		    		$("#fight_notice").text('');
		    		$("#into_fight").hide();
		    	}

		        $("#show").text(msg.data);
		    };

		    $(document).ready(function(){
		    	$("#btn_fight").click(function(){
		    		connection.send('waiting_fight');
		    		$("#wait_fight").show();
		    		$("#btn_fight").attr('disabled', true)
		    	})

		    	$("#leave_waiting_btn").click(function(){
		    		connection.send('leave_waiting');
		    	})

		    	$("#leave_fight_btn").click(function(){
		    		connection.send('leave_fight');
		    	})
		    })

		</script>
		<center>
			<div id='select_mode'>
				<button id='btn_fight'>Fight Mode!</button>
			</div>
			<br />

			<p id='user_notice'></p>

			<div id='wait_fight' style='display:none'>
				<p>System searching man for you!</p>
				<br />
				<button id='leave_waiting_btn'>Leave Waiting</button>
			</div>
			<br />

			<div id='into_fight' style='display:none'>
				<p id='fight_notice'></p>
				<div id='battle_info'>
					<p id='question'></p><br />
					<button id='btn_a'>A</button><br />
					<button id='btn_b'>B</button><br />
					<button id='btn_c'>C</button><br /><br />

				<button id='leave_fight_btn'>Leave Fight</button>
			<div>
		</center>
	</body>
</html>